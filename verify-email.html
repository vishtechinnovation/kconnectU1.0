<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>KonnectU Solutions</title>
        <!-- Tailwind -->
        <link href="src/output.css" rel="stylesheet" />
        <!-- <link
            href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
            rel="stylesheet" /> -->
        <!-- Alpine -->
        <script
            defer
            src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

        <!-- AOS -->
        <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
        <!-- Custom style -->
        <link rel="stylesheet" href="css/styles.css" />
        <!-- Poppins font -->
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
            rel="stylesheet" />
        <!-- Favicon -->
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="favicon_io/apple-touch-icon.png" />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="favicon_io/favicon-32x32.png" />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="favicon_io/favicon-16x16.png" />
        <link rel="manifest" href="/site.webmanifest" />

        <!-- Fontawesome Icons -->
        <script
            src="https://kit.fontawesome.com/2be225141f.js"
            crossorigin="anonymous"></script>
    </head>
    <body class="bg-gray-100 flex justify-center items-center h-screen">
        <div class="bg-white shadow-lg rounded-lg p-6 w-full max-w-md mx-4">
            <h1 class="text-2xl font-semibold text-gray-800 mb-4 text-center">
                Email Verification
            </h1>
            <p class="text-gray-600 text-center mb-6">
                Please wait while we verify your email...
            </p>

            <!-- Verification Result Message -->
            <div id="message" class="text-center text-gray-600"></div>
        </div>

        <script>
            const urlParams = new URLSearchParams(window.location.search);
            const codeFromUrl = urlParams.get("code"); // Get the 'code' from URL

            // Send the 'code' to the Google Apps Script endpoint for verification
            fetch(
                `https://script.google.com/macros/s/AKfycbxOELSjFwM7PzpDcp9GHnAiRvtLZq8KFGQhnh5nyGzo8qmA3ew2ItDEkdcAe2fVqt-mzA/exec?code=${codeFromUrl}`
            )
                .then((response) => response.text())
                .then((data) => {
                    // Display the result based on the response from Google Apps Script
                    document.getElementById("message").innerHTML = data;

                    // If the verification is successful, send the data to Google Forms
                    if (
                        data.includes(
                            "Your email has been successfully verified"
                        )
                    ) {
                        // Submit the form data to Google Forms
                        submitFormDataToGoogleForms();
                    }
                })
                .catch((error) => {
                    document.getElementById("message").innerHTML =
                        "Error verifying the code.";
                    console.error(error);
                });

            function submitFormDataToGoogleForms() {
                // Retrieve the form data (you should already have this in some way)
                const formData = {
                    firstName: "John",
                    lastName: "Doe",
                    email: "johndoe@example.com",
                    phone: "+2348123456789",
                    location: "Lagos, Nigeria",
                    profession: "Software Developer",
                };

                const formUrl =
                    "https://docs.google.com/forms/u/0/d/e/1FAIpQLSdrkRnL6L05367s0bYG6WJimzEsmDH7hHcOaZHiozdZCPbCTQ/formResponse";
                const payload = {
                    "entry.137930516": formData.firstName,
                    "entry.365860481": formData.lastName,
                    "entry.1596585368": formData.email,
                    "entry.1599107456": formData.phone,
                    "entry.344818518": formData.location,
                    "entry.1088893444": formData.profession,
                };

                const options = {
                    method: "post",
                    payload: payload,
                };

                fetch(formUrl, options)
                    .then((response) => response.text())
                    .then(() => {
                        setTimeout(() => {
                            window.location.href =
                                "https://kconnect-u1-0.vercel.app/"; // Redirect to homepage
                        }, 3000); // Redirect after 3 seconds
                    });
            }
        </script>
    </body>
</html>
